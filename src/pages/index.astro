---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { getBlogDates } from '../utils/git-dates';

const rawPosts = await getCollection('blog', ({ data }) => {
  return import.meta.env.DEV || !data.draft;
});

// ä¸ºæ¯ç¯‡æ–‡ç« è®¡ç®— Git æ—¶é—´
const posts = rawPosts.map((post) => {
  const { date, updatedDate } = getBlogDates(
    post.slug,
    post.data.date,
    post.data.updatedDate,
    post.data.disableUpdateDate
  );
  return { ...post, date, updatedDate };
}).sort((a, b) => {
  // ç½®é¡¶æ–‡ç« ä¼˜å…ˆ
  const aPinned = a.data.pinned ?? 0;
  const bPinned = b.data.pinned ?? 0;
  if (aPinned !== bPinned) return bPinned - aPinned;
  // æŒ‰æ›´æ–°æ—¶é—´æˆ–å‘å¸ƒæ—¶é—´æ’åº
  const aTime = (a.updatedDate ?? a.date).valueOf();
  const bTime = (b.updatedDate ?? b.date).valueOf();
  return bTime - aTime;
}).slice(0, 5);
---

<BaseLayout title="Fine - åšå®¢">
  <section class="hero">
    <h1>ä½ å¥½ï¼Œæˆ‘æ˜¯ Fine ğŸ‘‹</h1>
    <p>è¿™é‡Œè®°å½•æˆ‘çš„æŠ€æœ¯å­¦ä¹ ä¸æ€è€ƒï¼Œåˆ†äº«å¼€å‘ä¸­çš„ç»éªŒä¸å¿ƒå¾—ã€‚</p>
  </section>

  <section class="posts">
    <h2>æœ€æ–°æ–‡ç« </h2>
    <ul class="post-list">
      {posts.map((post) => (
        <li>
          <a href={`/blog/${post.slug}`}>
            <article>
              <h3>
              {post.data.pinned && <span class="pin-icon">ğŸ“Œ</span>}
              {post.data.title}
            </h3>
              <p class="meta">
                <time datetime={post.date.toISOString()}>
                  {post.date.toLocaleDateString('zh-CN')}
                </time>
              </p>
              <p class="excerpt">{post.data.description}</p>
            </article>
          </a>
        </li>
      ))}
    </ul>
    <a href="/blog" class="view-all">æŸ¥çœ‹å…¨éƒ¨æ–‡ç«  â†’</a>
  </section>
</BaseLayout>

<style>
  .hero {
    padding: 3rem 0;
    border-bottom: 1px solid var(--border);
  }

  .hero h1 {
    font-size: 2rem;
    margin-bottom: 0.75rem;
  }

  .hero p {
    color: var(--text-secondary);
    font-size: 1.1rem;
  }

  .posts {
    padding: 2rem 0;
  }

  .posts h2 {
    font-size: 1.25rem;
    margin-bottom: 1.5rem;
  }

  .post-list {
    list-style: none;
  }

  .post-list li {
    margin-bottom: 1.5rem;
  }

  .post-list a {
    text-decoration: none;
    color: inherit;
    display: block;
    padding: 1rem;
    border-radius: 8px;
    transition: background 0.2s;
  }

  .post-list a:hover {
    background: var(--bg-secondary);
  }

  .post-list h3 {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
    color: var(--text);
  }

  .pin-icon {
    margin-right: 0.25rem;
  }

  .meta {
    font-size: 0.85rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
  }

  .excerpt {
    color: var(--text-secondary);
    font-size: 0.95rem;
    line-height: 1.5;
  }

  .view-all {
    display: inline-block;
    margin-top: 1rem;
    font-size: 0.95rem;
  }
</style>
